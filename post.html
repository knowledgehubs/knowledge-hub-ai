<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Article — Knowledge Hub</title>
<meta name="description" content="Article from Knowledge Hub" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">

<style>
:root{--accent:#1a73e8;--muted:#6b7280;--bg:#fff}
*{box-sizing:border-box}
body{font-family:"Inter",system-ui,Arial;background:#fff;margin:0;color:#0f1724}
.container{max-width:880px;margin:26px auto;padding:20px}
.header{display:flex;align-items:center;gap:14px}
.logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,#0ea5e9,#7c3aed);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
.title{margin:8px 0 14px;font-family:"Merriweather",serif;font-size:28px}
.meta{color:var(--muted);font-size:13px;margin-bottom:12px;display:flex;gap:12px;align-items:center}
.content{line-height:1.8;font-size:17px;color:#0b1220}
hr{border:none;border-top:1px solid #eef2f6;margin:18px 0}
.suggest{display:flex;gap:12px;flex-wrap:wrap;margin-top:18px}
.suggest a{display:block;padding:8px 10px;border-radius:10px;background:#fbfdff;border:1px solid #eef5ff;color:var(--accent);text-decoration:none;font-weight:600}
/* CTA box */
.ctaBox{margin-top:18px;padding:16px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfdff);border:1px solid #eef5ff;display:flex;gap:12px;align-items:center;justify-content:space-between}
.ctaBox .left{max-width:70%}
.ctaBtn{background:var(--accent);color:#fff;padding:10px 14px;border-radius:10px;text-decoration:none;font-weight:700}
/* reading UI */
.meta .pill{background:#f1f5f9;padding:6px 8px;border-radius:8px;font-size:13px;color:#111}
@media (max-width:640px){.container{padding:14px}.title{font-size:22px}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo">KH</div>
    <div>
      <div style="font-weight:700">Knowledge Hub</div>
      <div style="font-size:13px;color:var(--muted)">Quick, practical, tested</div>
    </div>
  </div>

  <article id="article">
    <h1 id="post-title" class="title">Loading…</h1>
    <div class="meta" id="metaRow">
      <div class="pill" id="dateP">—</div>
      <div class="pill" id="readTime">—</div>
      <div id="tags" style="color:var(--muted);font-size:13px"></div>
    </div>

    <div id="content" class="content">…</div>

    <!-- CTA Zone (affiliate ready) -->
    <div id="ctaZone" class="ctaBox" style="display:none">
      <div class="left">
        <div style="font-weight:700" id="ctaTitle">Special offer</div>
        <div style="color:var(--muted);font-size:14px" id="ctaDesc">Click to see details.</div>
      </div>
      <div>
        <a id="ctaLink" class="ctaBtn" href="#" target="_blank" rel="noopener">Get it</a>
      </div>
    </div>

    <hr />
    <div style="color:var(--muted);font-size:14px">You may also like</div>
    <div id="suggestions" class="suggest"></div>
  </article>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
/* Helpers */
function qs(selector){return document.querySelector(selector)}
function calcReadTime(text){ const words = (text||'').trim().split(/\s+/).length; return Math.max(1, Math.round(words / 200)); }

/* Load requested file */
(async function(){
  const params = new URLSearchParams(window.location.search);
  const fileParam = params.get('file');
  if(!fileParam){ qs('#post-title').textContent = 'No file specified'; return; }
  try{
    const res = await fetch(fileParam);
    if(!res.ok) { qs('#post-title').textContent='Post not found'; return; }
    const md = await res.text();
    // Very simple front-matter detection for date/title (if you use plain md)
    // Render
    qs('#content').innerHTML = marked.parse(md);

    // Title detection: if md starts with "# Title"
    const titleMatch = md.match(/^#\s+(.+)$/m);
    const title = titleMatch ? titleMatch[1].trim() : fileParam.split('/').pop().replace(/^\d{4}-\d{2}-\d{2}-/,'').replace(/\.md$/,'').replace(/-/g,' ');
    qs('#post-title').textContent = title;

    // Date: filename start YYYY-MM-DD
    const fname = fileParam.split('/').pop();
    const datePart = fname.slice(0,10);
    qs('#dateP').textContent = new Date(datePart).toLocaleDateString();

    const plain = md.replace(/^#.*$/mg,'').replace(/```[\s\S]*?```/g,'');
    qs('#readTime').textContent = calcReadTime(plain) + ' min read';

    // Insert a CTA automatically from mapping: if the MD contains {AFFILIATE:KEYWORD} pattern we can replace
    const affMatch = md.match(/\{AFFILIATE\:([^\}\n]+)\}/i);
    if(affMatch){
      // placeholder logic — later hook to Redirect Sheet data map
      const offerKey = affMatch[1].trim();
      // Example: transform offerKey -> affiliate link (admin must replace)
      const demoLink = `https://example.com/offer/${encodeURIComponent(offerKey)}`;
      qs('#ctaTitle').textContent = 'Recommended — ' + offerKey;
      qs('#ctaDesc').textContent = 'Top pick based on article topic. Safe & tested.';
      qs('#ctaLink').href = demoLink;
      qs('#ctaZone').style.display = 'flex';
    }

    // Suggestions: list other posts (simple approach)
    const listing = await (await fetch('posts/')).text();
    const files = [...listing.matchAll(/href="([^"]+\.md)"/g)].map(m=>m[1]);
    const suggestions = files.filter(f=>f!==fileParam.split('/').pop()).slice(0,6);
    const sugBox = qs('#suggestions');
    sugBox.innerHTML = suggestions.map(s=>{
      const title = s.replace(/^\d{4}-\d{2}-\d{2}-/,'').replace(/\.md$/,'').replace(/-/g,' ');
      return `<a href="post.html?file=posts/${encodeURIComponent(s)}" style="text-decoration:none">${title}</a>`;
    }).join('');
  }catch(e){
    console.error(e);
    qs('#post-title').textContent = 'Error loading post';
  }
})();
</script>
</body>
</html>
