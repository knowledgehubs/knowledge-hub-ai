<script>
async function loadPosts() {
    try {
        const res = await fetch("./posts/index.json");
        const files = await res.json();

        window.allPosts = files.map(f => {
            const date = f.slice(0,10);
            const title = f
                .replace(".md", "")
                .replace(/^\d{4}-\d{2}-\d{2}-/, "")
                .replace(/-/g, " ");

            return { file:f, title:title, date:date };
        }).reverse();

        renderPosts(window.allPosts);
    } catch(e) {
        document.getElementById("empty").innerText = "Error loading posts.";
        console.error(e);
    }
}

function renderPosts(list) {
    const container = document.getElementById("posts");
    const empty = document.getElementById("empty");
    container.innerHTML = "";

    if(list.length === 0){
        empty.style.display = "block";
        return;
    }
    empty.style.display = "none";

    list.forEach(p => {
        container.innerHTML += `
            <div class="card">
                <a href="post.html?file=posts/${p.file}">${p.title}</a>
                <small>${new Date(p.date).toLocaleDateString()}</small>
            </div>
        `;
    });
}

document.getElementById("searchBox").addEventListener("input", e => {
    const q = e.target.value.toLowerCase();
    const results = window.allPosts.filter(p => p.title.toLowerCase().includes(q));
    renderPosts(results);
});

loadPosts();
</script>
